YUI.add("moodle-atto_subtitle-button",function(e,t){var n="atto_subtitle",r="subtitle",i={LINK:"LINK",VIDEO:"VIDEO",AUDIO:"AUDIO"},s={VIDEO:"atto_subtitle_video",AUDIO:"atto_subtitle_audio",UPLOAD:"atto_subtitle_upload",SUBTITLE:"atto_subtitle_subtitle",SUBTITLE_CHECKBOX:"atto_subtitle_subtitle_checkbox",MEDIAINSERT_CHECKBOX:"atto_subtitle_mediainsert_checkbox",ATTO_CLOUDPOODLL_FORM:"atto_subtitle_form",CP_VIDEO:"atto_subtitle_video_cont",CP_AUDIO:"atto_subtitle_audio_cont",CP_UPLOAD:"atto_subtitle_upload_cont",CP_SWAP:"atto_subtitle_swapmeout"},o={subtitling:!1},u={ROOT:'<div class="wrapper">\n\n            <div class="player" id="root">\n\n                \n\n                <div id="poodllsubtitle_previewbox" class="poodllsubtitle_previewbox top-box">\n                    <video id="poodllsubtitle_video" class="poodllsubtitle_video" width="100%" style="display: none"></video>\n                    <audio id="poodllsubtitle_audio" class="poodllsubtitle_audio" width="100%" style="display: none"></audio>\n                    <div id="poodllsubtitle_previewline"  class="poodllsubtitle_previewline text-box"></div>\n                </div>\n\n                <div class="bottom-box">\n                    <div class="control-panel">\n                        <div class="progress-bar">\n                            <span class="time time-current">0:00</span>\n                            <div class="progress-line">\n                                <span class="green-progress"></span>\n                                <span class="progress-marker"></span>\n                            </div>\n                            <span class="time time-total">0:00</span>\n                        </div>\n                        <div class="buttons-group">\n                            <a id="poodllsubtitle_addnew" class="poodllsubtitle_addnew btn add" title="Add new Subtitle"></a>\n                            <a class="btn prev" id="btn_prev" title="Loop Back"></a>\n                            <a class="btn play" id="btn_play" title="Play/Pause"></a>\n                            <a class="btn next" id="btn_next" title="Loop Forward"></a>\n                        </div>\n                    </div>\n                    <div class="subtitleset_container">\n                        <div id=\'poodllsubtitle_tiles\' class=\'poodllsubtitle_tiles subtitleset_list\'></div>\n                        <div class="save_and_download">\n                            <a class="save_btn" href="#" id="poodllsubtitle_save">Save and download</a>\n                            <a class="cancel_btn" href="#" id="poodllsubtitle_cancelall" title="Cancel all Changes"></a>\n                        </div>\n                    </div>\n                </div>\n\n                <div id=\'poodllsubtitle_editor\' class="\'poodllsubtitle_editor\' subtitleset_block subtitleset_block_open" style=\'display: none;\'>\n                        <div class="numb_song"></div>\n                        <div class="subtitleset_time">\n                            <div class="block_input">\n                                <input type="text" name="poodllsubtitle_edstart" id="poodllsubtitle_edstart" class="poodllsubtitle_edstart">\n                                <div class="input_arr_block">\n                                    <div class="input_arr input_arr_top"></div>\n                                    <div class="input_arr input_arr_bot"></div>\n                                </div>\n                            </div>\n                            <button type="button" id="poodllsubtitle_startsetnow" class="poodllsubtitle_startsetnow now_btn">Now</button>\n                            <div class="block_input">\n                                <input type="text" name="poodllsubtitle_edend" id="poodllsubtitle_edend" class="poodllsubtitle_edpart">\n                                <div class="input_arr_block">\n                                    <div class="input_arr input_arr_top"></div>\n                                    <div class="input_arr input_arr_bot"></div>\n                                </div>\n                            </div>\n                            <button type="button" id="poodllsubtitle_endsetnow" class="poodllsubtitle_endsetnow now_btn">Now</button>\n                        </div>\n                        <div class="subtitleset_text">\n                            <textarea class="textarea" name="poodllsubtitle_edpart" id="poodllsubtitle_edpart" class="poodllsubtitle_edpart"></textarea>\n                        </div>\n                        <div class="subtitleset_btns">\n                            <div class="subs_btn_block subs_basket poodllsubtitle_eddelete" id="poodllsubtitle_eddelete">\n                                <img src="{{imgpath}}btn_ic_1.svg">\n                            </div>\n                            <div class="subs_btn_block subs_btn_menu poodllsubtitle_edapply" id="poodllsubtitle_edapply"></div>\n                            <div class="subs_btn_block poodllsubtitle_edmergeup" id="poodllsubtitle_edmergeup">\n                                <img src="{{imgpath}}btn_ic_2.svg">\n                            </div>\n                            <div class="subs_btn_block poodllsubtitle_edsplit" id="poodllsubtitle_edsplit">\n                                <img src="{{imgpath}}btn_ic_3.svg">\n                            </div>\n                            <button type="button" id="poodllsubtitle_edcancel" class="poodllsubtitle_edcancel">Cancel</button>\n                        </div>\n                    </div>\n\n            </div>\n        </div>',HTML_MEDIA:{VIDEO:'&nbsp;<video &nbsp;<audio controls="true" crossorigin="anonymous"><source src="{{url}}">{{#if issubtitling}}<track src="{{subtitleurl}}" kind="caption" srclang="{{language}}" label="{{language}}" default="true">{{/if}}</video>&nbsp;',AUDIO:'&nbsp;<audio controls="true" crossorigin="anonymous"><source src="{{url}}">{{#if issubtitling}}<track src="{{subtitleurl}}" kind="caption" srclang="{{language}}" label="{{language}}" default="true">{{/if}}</audio>&nbsp;'
,LINK:'&nbsp;<a href="{{url}}" {{#if issubtitling}} data-subtitles="{{subtitleurl}}" data-language="{{language}}" {{/if}}>{{name}}</a>&nbsp;'}};e.namespace("M.atto_subtitle").Button=e.Base.create("button",e.M.editor_atto.EditorPlugin,[],{initializer:function(e){e.disabled||this.addButton({icon:r,iconComponent:n,title:"subtitle",buttonName:r,callback:this._displayDialogue,callbackArgs:null})},_fetchSelectedURLs_mediatag:function(e){var t={mediaurl:!1,vtturl:!1},n=e?this._getMediumProperties(e):!1;return n&&(n.sources&&n.sources.length>0?t.mediaurl=n.sources[0]:t.mediaurl=n.src,n.tracks&&"captions"in n.tracks&&n.tracks.captions.length>0&&(t.vtturl=n.tracks.captions[0].src)),t},_fetchSelectedURLs_anchor:function(){var t=this.get("host").getSelectionParentNode(),n=null,r=null,i={mediaurl:!1,vtturl:!1};if(!t)return i;n=this._findSelectedAnchors(e.one(t));if(n.length>0){r=n[0],this._currentSelection=this.get("host").getSelectionFromNode(r),i.mediaurl=r.getAttribute("href"),i.vtturl=r.getAttribute("data-subtitles");if(i.vtturl==""&&i.mediaurl!=""){var s=new URL(i.mediaurl),o=new URLSearchParams(s.search);o&&(i.vtturl=o.get("data-subtitles"))}}return i},_getMediumProperties:function(e){var t=function(e,t){return e.getAttribute(t)?!0:!1},n={subtitles:[],captions:[],descriptions:[],chapters:[],metadata:[]};return e.all("track").each(function(e){n[e.getAttribute("kind")].push({src:e.getAttribute("src"),srclang:e.getAttribute("srclang"),label:e.getAttribute("label"),defaultTrack:t(e,"default")})}),{type:e.test("video")?i.VIDEO:i.AUDIO,sources:e.all("source").get("src"),src:e.getAttribute("src"),poster:e.getAttribute("poster"),width:e.getAttribute("width"),height:e.getAttribute("height"),autoplay:t(e,"autoplay"),loop:t(e,"loop"),muted:t(e,"muted"),controls:t(e,"controls"),tracks:n}},_findSelectedAnchors:function(e){var t=e.get("tagName"),n,r;return t&&t.toLowerCase()==="a"?[e]:(r=[],e.all("a").each(function(e){!n&&this.get("host").selectionContainsNode(e)&&r.push(e)},this),r.length>0?r:(n=e.ancestor("a"),n?[n]:[]))},_getContext:function(t){return e.merge({elementid:this.get("host").get("elementid"),imgpath:M.cfg.wwwroot+"/lib/editor/atto/plugins/subtitle/pix/e/",component:n,helpStrings:this.get("help"),CSS:s},t)},_displayDialogue:function(e,t){if(this.get("host").getSelection()===!1)return;var i=M.util.get_string("subtitle",n),s="1200px",u={};u.headerContent=i,u.focusAfterHide=r,u.width=s;var a=this.getDialogue(u);a.set("bodyContent",this._getDialogueContent()).show(),o.elementid=this.get("host").get("elementid");var f=this;this._loadSubtitleEditor()},_loadSubtitleEditor:function(){var e=this;e.uploaded=!1;var t=this.get("host").getSelectedNodes().filter("video,audio").shift();if(t)var n=this._fetchSelectedURLs_mediatag(t);else var n=this._fetchSelectedURLs_anchor();require(["atto_subtitle/loader"],function(e){e.init(n)})},_getDialogueContent:function(t){var n=e.Node.create(e.Handlebars.compile(u.ROOT)(this._getContext()));return n},_doInsert:function(t,n){this.getDialogue({focusAfterHide:null}).hide();var r={};r.url=t,r.name=n,r.issubtitling=o.subtitling,r.language=CLOUDPOODLL.language,r.subtitleurl=t+".vtt";var i=u.HTML_MEDIA.LINK;switch(o.insertmethod){case INSERTMETHOD.TAGS:o.currentrecorder==RECORDERS.VIDEO?(r.width=!1,r.height=!1,r.poster=!1,i=u.HTML_MEDIA.VIDEO):(r.width=!1,r.height=!1,r.poster=!1,i=u.HTML_MEDIA.AUDIO);break;case INSERTMETHOD.LINK:default:}var s=e.Handlebars.compile(i)(r);this.editor.focus(),this.get("host").insertContentAtFocusPoint(s),this.markUpdated()}},{ATTRS:{disabled:{value:!1}}})},"@VERSION@");
